#include <stdio.h>
#include "system.h"
#include "altera_avalon_pio_regs.h"
#include "altera_avalon_timer_regs.h"
#include "sys/alt_irq.h"



volatile int led_state = 0;


static void handle_timer_interrupt(void *context)
{

    IOWR_ALTERA_AVALON_TIMER_STATUS(TIMER_0_BASE, 0);

    static int contador_tempo = 0;
    contador_tempo++;

    if (contador_tempo >= 500)
    {
        led_state = !led_state;

        if (led_state) {
            IOWR_ALTERA_AVALON_PIO_DATA(LEDS_BASE, 0x3FF);
        } else {
            IOWR_ALTERA_AVALON_PIO_DATA(LEDS_BASE, 0x000);
        }

        contador_tempo = 0;
    }
}


int main()
{
	int *a = HEX_0_BASE;
	*a = 0xFFFFFFFF;


    alt_ic_isr_register(
        TIMER_0_IRQ_INTERRUPT_CONTROLLER_ID,
        TIMER_0_IRQ,
        handle_timer_interrupt,
        NULL,
        NULL
    );



    IOWR_ALTERA_AVALON_TIMER_CONTROL(TIMER_0_BASE,
        ALTERA_AVALON_TIMER_CONTROL_ITO_MSK  |
        ALTERA_AVALON_TIMER_CONTROL_CONT_MSK |
        ALTERA_AVALON_TIMER_CONTROL_START_MSK);


    IOWR_ALTERA_AVALON_PIO_DATA(HEX_0_BASE, 0x07F);
    int contagem_main = 0;
    while(1)
    {

    }

    return 0;
}
